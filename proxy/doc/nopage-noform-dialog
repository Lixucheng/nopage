{"id":1038950,"slug":"dialog","title":"Dialog 弹窗表单","book_id":187346,"book":{"id":187346,"type":"Book","slug":"noform","name":"NoForm","user_id":222786,"description":"NoForm - 让天下没有难做的表单","creator_id":110109,"public":1,"items_count":31,"likes_count":0,"watches_count":1,"content_updated_at":"2018-12-15T02:46:15.948Z","updated_at":"2018-12-15T02:46:15.000Z","created_at":"2018-12-11T00:41:54.000Z","namespace":"nopage/noform","user":{"id":222786,"type":"Group","login":"nopage","name":"NoPage","description":"NoPage - 让天下没有难做的CRUD","avatar_url":"https://gw.alipayobjects.com/zos/rmsportal/SZXCSCJTuhRSmAggBlVp.png","large_avatar_url":"https://gw.alipayobjects.com/zos/rmsportal/SZXCSCJTuhRSmAggBlVp.png?x-oss-process=image/resize,m_fill,w_320,h_320","medium_avatar_url":"https://gw.alipayobjects.com/zos/rmsportal/SZXCSCJTuhRSmAggBlVp.png?x-oss-process=image/resize,m_fill,w_160,h_160","small_avatar_url":"https://gw.alipayobjects.com/zos/rmsportal/SZXCSCJTuhRSmAggBlVp.png?x-oss-process=image/resize,m_fill,w_80,h_80","books_count":5,"public_books_count":4,"followers_count":0,"following_count":0,"created_at":"2018-12-11T00:38:10.000Z","updated_at":"2018-12-11T08:20:27.000Z","_serializer":"v2.user"},"_serializer":"v2.book"},"user_id":110109,"creator":{"id":110109,"type":"User","login":"guishu","name":"鬼鼠","description":null,"avatar_url":"https://cdn.yuque.com/yuque/0/2018/png/110109/1527234002873-avatar/2ccdab19-b7e2-42d6-b097-f42de766f94c.png","large_avatar_url":"https://cdn.yuque.com/yuque/0/2018/png/110109/1527234002873-avatar/2ccdab19-b7e2-42d6-b097-f42de766f94c.png?x-oss-process=image/resize,m_fill,w_320,h_320","medium_avatar_url":"https://cdn.yuque.com/yuque/0/2018/png/110109/1527234002873-avatar/2ccdab19-b7e2-42d6-b097-f42de766f94c.png?x-oss-process=image/resize,m_fill,w_160,h_160","small_avatar_url":"https://cdn.yuque.com/yuque/0/2018/png/110109/1527234002873-avatar/2ccdab19-b7e2-42d6-b097-f42de766f94c.png?x-oss-process=image/resize,m_fill,w_80,h_80","books_count":3,"public_books_count":1,"followers_count":0,"following_count":0,"created_at":"2018-04-24T06:58:34.000Z","updated_at":"2018-12-14T07:36:21.000Z","_serializer":"v2.user"},"format":"asl","body":"","body_draft":"","body_html":"<h1 id=\"ztfbgt\" data-type=\"h\"><a class=\"anchor\" id=\"-属性配置\" href=\"#ztfbgt\"></a> 属性配置</h1><div class=\"bi-table\"><table><colgroup><col width=\"130px\"/><col width=\"130px\"/><col width=\"318px\"/><col width=\"356px\"/></colgroup><tbody><tr height=\"34px\"><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">属性名</div></td><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">类型</div></td><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">说明</div></td><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">默认值</div></td></tr><tr height=\"34px\"><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">title</div></td><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">string/jsx</div></td><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">弹窗表单标题</div></td><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">null</div></td></tr><tr height=\"34px\"><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">content</div></td><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">string/jsx</div></td><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">弹窗内容</div><ul data-type=\"unordered-list\"><li data-type=\"list-item\" data-list-type=\"unordered-list\"><div data-type=\"p\">内容可以为字符串</div></li><li data-type=\"list-item\" data-list-type=\"unordered-list\"><div data-type=\"p\">也可以是任意jsx元素</div></li><li data-type=\"list-item\" data-list-type=\"unordered-list\"><div data-type=\"p\">如果包含NoForm，会自动识别并增加footer在表单的最下面</div></li></ul></td><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">null</div></td></tr><tr height=\"34px\"><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">enableValidate</div></td><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">boolean</div></td><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">如果content中包含NoForm，并且enableValidate为 true，onOk之前会执行validate</div><div data-type=\"p\">方法，校验通过会进入onOk，反之则什么都不做。</div></td><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">undefined</div></td></tr><tr height=\"34px\"><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">onOk</div></td><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">function</div></td><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">点击确认时执行</div><div data-type=\"p\"></div><div data-type=\"p\">接受返回值为promise，返回为promise时，按钮会进入loading状态，resolve后会释放loading状态。</div></td><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">() =&gt; {}</div></td></tr><tr height=\"34px\"><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">onCancel</div></td><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">function</div></td><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">点击取消时执行</div></td><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">() =&gt; {}</div></td></tr><tr height=\"34px\"><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">locale</div></td><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">string/object</div></td><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">国际化的标识，字符串以中美为例</div><div data-type=\"p\">zh 中文</div><div data-type=\"p\">en 英文</div></td><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">en</div></td></tr><tr height=\"34px\"><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">style</div></td><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">object</div></td><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">内联样式</div></td><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">{}</div></td></tr><tr height=\"34px\"><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">width</div></td><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">string</div></td><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\">弹窗宽度</div></td><td rowspan=\"1\" colSpan=\"1\"><div data-type=\"p\"></div></td></tr></tbody></table></div><div data-type=\"p\"></div><div data-type=\"p\"></div><h1 id=\"5aymov\" data-type=\"h\"><a class=\"anchor\" id=\"关键部分\" href=\"#5aymov\"></a>关键部分</h1><div data-type=\"p\"></div><div data-type=\"p\"><code>表单的values</code> 和 <code>隐藏弹窗的hide</code> 方法在onOk的入参 。 onOk 接受promise返回，在这个promise里面，你可以自由控制发送的请求，控制成功和失败的相应行为，</div><div data-type=\"p\"></div><pre data-syntax=\"jsx\"><code class=\"language-jsx\">Dialog.show({\n    title: &#x27;title&#x27;,\n    content: &lt;Form&gt;\n        &lt;FormItem label=&quot;username&quot; name=&quot;username&quot;&gt;&lt;Input /&gt;&lt;FormItem&gt;\n    &lt;/Form&gt;,\n    onOk: (values, hide) =&gt; { // return promise\n        return new Promise(async (resolve, reject) =&gt; {\n            try {\n                const result = await mockRequest(&#x27;url&#x27;, values);\n                resolve();\n                console.log({ title: &#x27;success&#x27;, onOk: hide });\n            } catch (e) {\n                reject();\n                console.log({ title: &#x27;error&#x27; });            \n            }\n        });\n    }\n});\n</code></pre><div data-type=\"p\"></div><div data-type=\"p\"></div><h1 id=\"g4hhgv\" data-type=\"h\"><a class=\"anchor\" id=\"ant-design-实现\" href=\"#g4hhgv\"></a>Ant-Design 实现</h1><div data-type=\"p\"></div><pre data-syntax=\"jsx\"><code class=\"language-jsx\">import Form, { FormItem, FormCore } from &#x27;noform&#x27;;\nimport { Input, Select, Checkbox, Radio, Switch, Slider, DatePicker, TimePicker,\n    Rate, Cascader, TreeSelect, Upload, Button, InputNumber, AutoComplete, Dialog } from &#x27;nowrapper/lib/antd&#x27;;\nimport { Alert, Icon, message } from &#x27;antd&#x27;;\n\nconst sleep = (mills) =&gt; new Promise(resolve =&gt; setTimeout(resolve, mills));\nconst dialogForm = () =&gt; {\n    const core = new FormCore({\n        onChange: (firekeys, values, ctx) =&gt; {\n            const { province } = values;\n            if (firekeys.indexOf(&#x27;province&#x27; !== -1) &amp;&amp; province === &#x27;广东省&#x27;) {\n                ctx.setItemProps(&#x27;city&#x27;, { options: [{ label: &#x27;深圳&#x27;, value: &#x27;深圳&#x27; }] })\n            }\n        }\n    });\n    Dialog.show({\n        footerAlign: &#x27;label&#x27;,\n        title: &#x27;dialog&#x27;,\n        locale: &#x27;zh&#x27;,\n        content: &lt;Form core={core} layout={{ label: 4, control: 20 }}&gt;\n            &lt;div className=&quot;list-dialog-hint&quot; &gt;地址维护&lt;/div&gt;\n            &lt;FormItem label=&quot;province&quot; name=&quot;province&quot;&gt;\n                &lt;Select options={[{ label: &#x27;广东省&#x27;, value: &#x27;广东省&#x27; }]} /&gt;\n            &lt;/FormItem&gt;\n            &lt;FormItem label=&quot;city&quot; name=&quot;city&quot;&gt;\n                &lt;Select options={[]} /&gt;\n            &lt;/FormItem&gt;\n        &lt;/Form&gt;,\n        onOk: async (values, hide) =&gt; {\n            console.log(&#x27;values&#x27;, values);\n            await sleep(1000);\n            message.success(&#x27;This is a message of success&#x27;, 1, hide);\n        },\n        onCancel: () =&gt; {\n            \n        }\n    });\n}\n\n</code></pre><div data-type=\"p\"></div><h1 id=\"mbr4pe\" data-type=\"h\"><a class=\"anchor\" id=\"fusion-next\" href=\"#mbr4pe\"></a>Fusion-Next</h1><div data-type=\"p\"></div><pre data-syntax=\"jsx\"><code class=\"language-jsx\">import Form, { FormItem, FormCore } from &#x27;noform&#x27;;\nimport { Input, Select, Checkbox, Radio, Switch, Range, DatePicker, TimePicker,\n    Rating, CascaderSelect, Upload, Button, NumberPicker, Dialog } from &#x27;nowrapper/lib/next&#x27;;\nimport { Message, Icon } from &#x27;@alifd/next&#x27;;\n\nconst sleep = (mills) =&gt; new Promise(resolve =&gt; setTimeout(resolve, mills));\nconst dialogForm = () =&gt; {\n    const core = new FormCore({\n        onChange: (firekeys, values, ctx) =&gt; {\n            const { province } = values;\n            if (firekeys.indexOf(&#x27;province&#x27; !== -1) &amp;&amp; province === &#x27;广东省&#x27;) {\n                ctx.setItemProps(&#x27;city&#x27;, { options: [{ label: &#x27;深圳&#x27;, value: &#x27;深圳&#x27; }] })\n            }\n        }\n    });\n    Dialog.show({\n        footerAlign: &#x27;label&#x27;,\n        title: &#x27;dialog&#x27;,\n        locale: &#x27;zh&#x27;,\n        content: &lt;Form core={core} layout={{ label: 4, control: 20 }}&gt;\n            &lt;div className=&quot;list-dialog-hint&quot; &gt;地址维护&lt;/div&gt;\n            &lt;FormItem label=&quot;province&quot; name=&quot;province&quot;&gt;\n                &lt;Select options={[{ label: &#x27;广东省&#x27;, value: &#x27;广东省&#x27; }]} /&gt;\n            &lt;/FormItem&gt;\n            &lt;FormItem label=&quot;city&quot; name=&quot;city&quot;&gt;\n                &lt;Select options={[]} /&gt;\n            &lt;/FormItem&gt;\n        &lt;/Form&gt;,\n        onOk: async (values, hide) =&gt; {\n            console.log(&#x27;values&#x27;, values);\n            await sleep(1000);\n            message.success(&#x27;This is a message of success&#x27;, 1, hide);\n        },\n        onCancel: () =&gt; {\n            \n        }\n    });\n}\n\n</code></pre><div data-type=\"p\"></div>","public":1,"status":null,"likes_count":0,"comments_count":0,"content_updated_at":"2018-12-10T07:30:53.000Z","deleted_at":null,"created_at":"2018-12-08T09:33:48.000Z","updated_at":"2018-12-11T00:42:43.000Z","published_at":"2018-12-10T07:30:53.000Z","word_count":787,"_serializer":"v2.doc_detail"}