{"id":1061341,"slug":"step-form-ant","title":"Ant-Design-Pro StepForm","book_id":187346,"book":{"id":187346,"type":"Book","slug":"noform","name":"NoForm","user_id":222786,"description":"NoForm - 让天下没有难做的表单","creator_id":110109,"public":1,"items_count":32,"likes_count":0,"watches_count":4,"content_updated_at":"2018-12-17T12:27:23.348Z","updated_at":"2018-12-22T00:11:04.000Z","created_at":"2018-12-11T00:41:54.000Z","namespace":"nopage/noform","user":{"id":222786,"type":"Group","login":"nopage","name":"NoPage","description":"NoPage - 让天下没有难做的CRUD","avatar_url":"https://gw.alipayobjects.com/zos/rmsportal/SZXCSCJTuhRSmAggBlVp.png","large_avatar_url":"https://gw.alipayobjects.com/zos/rmsportal/SZXCSCJTuhRSmAggBlVp.png?x-oss-process=image/resize,m_fill,w_320,h_320","medium_avatar_url":"https://gw.alipayobjects.com/zos/rmsportal/SZXCSCJTuhRSmAggBlVp.png?x-oss-process=image/resize,m_fill,w_160,h_160","small_avatar_url":"https://gw.alipayobjects.com/zos/rmsportal/SZXCSCJTuhRSmAggBlVp.png?x-oss-process=image/resize,m_fill,w_80,h_80","books_count":5,"public_books_count":4,"followers_count":0,"following_count":0,"created_at":"2018-12-11T00:38:10.000Z","updated_at":"2018-12-11T08:20:27.000Z","_serializer":"v2.user"},"_serializer":"v2.book"},"user_id":110109,"creator":{"id":110109,"type":"User","login":"guishu","name":"鬼鼠","description":null,"avatar_url":"https://cdn.yuque.com/yuque/0/2018/png/110109/1527234002873-avatar/2ccdab19-b7e2-42d6-b097-f42de766f94c.png","large_avatar_url":"https://cdn.yuque.com/yuque/0/2018/png/110109/1527234002873-avatar/2ccdab19-b7e2-42d6-b097-f42de766f94c.png?x-oss-process=image/resize,m_fill,w_320,h_320","medium_avatar_url":"https://cdn.yuque.com/yuque/0/2018/png/110109/1527234002873-avatar/2ccdab19-b7e2-42d6-b097-f42de766f94c.png?x-oss-process=image/resize,m_fill,w_160,h_160","small_avatar_url":"https://cdn.yuque.com/yuque/0/2018/png/110109/1527234002873-avatar/2ccdab19-b7e2-42d6-b097-f42de766f94c.png?x-oss-process=image/resize,m_fill,w_80,h_80","books_count":3,"public_books_count":1,"followers_count":0,"following_count":0,"created_at":"2018-04-24T06:58:34.000Z","updated_at":"2018-12-14T07:36:21.000Z","_serializer":"v2.user"},"format":"asl","body":"","body_draft":"","body_html":"<h1 id=\"2lpvwq\" data-type=\"h\"><a class=\"anchor\" id=\"概述\" href=\"#2lpvwq\"></a>概述</h1><div data-type=\"p\">本小节主要是用NoForm去改造 Ant-Desgn-Pro 的 Step-Form。我们会用1个step去代替原本step1和step2这两个文件，开发者应该也能感受到NoForm对于表单的控制力是非常优秀的, 不过这里有点强迫合在一起了，主要目的还是尽可能体现改写后的改进，开发者可以更合理去管理代码，Step.jsx 改进如下：</div><div data-type=\"p\"></div><pre data-syntax=\"jsx\"><code class=\"language-jsx\">import React, { Fragment } from &#x27;react&#x27;;\nimport { connect } from &#x27;dva&#x27;;\nimport Form, { FormItem, Item, FormCore, If } from &#x27;noform&#x27;;\nimport { Input, Button, Select } from &#x27;nowrapper/lib/antd&#x27;;\nimport { Divider, Alert } from &#x27;antd&#x27;;\nimport router from &#x27;umi/router&#x27;;\nimport styles from &#x27;./style.less&#x27;;\n\nconst { Option } = Select;\n\nconst formItemLayout = { label: 5, control: 19 };\n\n@connect(({ form, loading }) =&gt; ({\n  submitting: loading.effects[&#x27;form/submitStepForm&#x27;],\n  data: form.step,\n}))\nclass Step extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    const { route } = props;\n    const { name } = route;\n    this.isConfirm = name === &#x27;confirm&#x27;;\n    this.core = new FormCore({\n      globalStatus: this.isConfirm ? &#x27;preview&#x27; : &#x27;edit&#x27;,\n      autoValidate: true,\n      values: props.data,\n      validateConfig: {\n        payAccount: [{ required: true, message: &#x27;请选择付款账户&#x27; }],\n        receiverAccount: [\n          { required: true, message: &#x27;请输入收款人账户&#x27; },\n          { type: &#x27;email&#x27;, message: &#x27;账户名应为邮箱格式&#x27; },\n        ],\n        receiverName: [{ required: true, message: &#x27;请输入收款人姓名&#x27; }],\n        amount: [\n          { required: true, message: &#x27;请输入转账金额&#x27; },\n          {\n            pattern: /^(\\d+)((?:\\.\\d+)?)$/,\n            message: &#x27;请输入合法金额数字&#x27;,\n          },\n        ],\n        password: [{ required: true, message: &#x27;需要支付密码才能进行支付&#x27; }]\n      }\n    });\n  }\n\n  render() {\n    const { dispatch, submitting } = this.props;\n    const onValidateForm = async() =&gt; {\n      const err = await this.core.validate();\n      const values = this.core.getValues();\n      if (!err) {\n        if (this.isConfirm) {\n          dispatch({\n            type: &#x27;form/submitStepForm&#x27;,\n            payload: values,\n          });\n        } else {\n          dispatch({\n            type: &#x27;form/saveStepFormData&#x27;,\n            payload: values,\n          });\n          router.push(&#x27;/form/step-form/confirm&#x27;);\n        }\n      }\n    };\n    const onPrev = () =&gt; {\n      router.push(&#x27;/form/step-form/info&#x27;);\n    };\n\n    return (\n      &lt;Fragment&gt;\n        &lt;Form core={this.core} layout={formItemLayout} className={styles.stepForm}&gt;\n          &lt;If when={() =&gt; this.isConfirm}&gt;\n            &lt;Alert\n              closable\n              showIcon\n              message=&quot;确认转账后，资金将直接打入对方账户，无法退回。&quot;\n              style={{ marginBottom: 24 }}\n            /&gt;\n          &lt;/If&gt;\n\n          &lt;FormItem label=&quot;付款账户&quot; name=&quot;payAccount&quot;&gt;\n            &lt;Select placeholder=&quot;test@example.com&quot;&gt;\n              &lt;Option value=&quot;ant-design@alipay.com&quot;&gt;ant-design@alipay.com&lt;/Option&gt;\n            &lt;/Select&gt;\n          &lt;/FormItem&gt;\n          &lt;FormItem label=&quot;收款账户&quot;&gt;\n            &lt;Input.Group compact&gt;\n              &lt;Item name=&quot;receiverAccountType&quot; defaultValue=&quot;alipay&quot;&gt;\n                &lt;Select style={{ width: 100 }}&gt;\n                  &lt;Option value=&quot;alipay&quot;&gt;支付宝&lt;/Option&gt;\n                  &lt;Option value=&quot;bank&quot;&gt;银行账户&lt;/Option&gt;\n                &lt;/Select&gt;\n              &lt;/Item&gt;\n              &lt;Item name=&quot;receiverAccount&quot;&gt;\n                &lt;Input style={{ width: &#x27;calc(100% - 100px)&#x27; }} placeholder=&quot;test@example.com&quot; /&gt;\n              &lt;/Item&gt;\n            &lt;/Input.Group&gt;\n          &lt;/FormItem&gt;\n          &lt;FormItem label=&quot;收款人姓名&quot; name=&quot;receiverName&quot;&gt;\n            &lt;Input placeholder=&quot;请输入收款人姓名&quot; /&gt;\n          &lt;/FormItem&gt;\n          &lt;FormItem label=&quot;转账金额&quot; name=&quot;amount&quot;&gt;\n            &lt;Input prefix=&quot;￥&quot; placeholder=&quot;请输入金额&quot; /&gt;\n          &lt;/FormItem&gt;\n          &lt;If when={() =&gt; !this.isConfirm}&gt;\n            &lt;FormItem label=&quot;&quot;&gt;\n              &lt;Button type=&quot;primary&quot; onClick={onValidateForm}&gt;下一步&lt;/Button&gt;\n            &lt;/FormItem&gt;\n          &lt;/If&gt;\n          &lt;Divider style={{ margin: &#x27;40px 0 24px&#x27; }} /&gt;\n          &lt;If when={() =&gt; this.isConfirm}&gt;\n            &lt;div&gt;\n              &lt;FormItem label=&quot;支付密码&quot; status=&quot;edit&quot; required={false} name=&quot;password&quot; defaultValue=&quot;123456&quot;&gt;\n                &lt;Input type=&quot;password&quot; autoComplete=&quot;off&quot; style={{ width: &#x27;80%&#x27; }} /&gt;\n              &lt;/FormItem&gt;\n              &lt;FormItem label=&quot;&quot;&gt;\n                &lt;div&gt;\n                  &lt;Button type=&quot;primary&quot; onClick={onValidateForm} loading={submitting}&gt;\n                    提交\n                  &lt;/Button&gt;\n                  &lt;Button onClick={onPrev} style={{ marginLeft: 8 }}&gt;\n                    上一步\n                  &lt;/Button&gt;\n                &lt;/div&gt;\n              &lt;/FormItem&gt;\n            &lt;/div&gt;\n          &lt;/If&gt;       \n          &lt;If when={() =&gt; !this.isConfirm}&gt;\n            &lt;div className={styles.desc}&gt;\n              &lt;h3&gt;说明&lt;/h3&gt;\n              &lt;h4&gt;转账到支付宝账户&lt;/h4&gt;\n              &lt;p&gt;\n            如果需要，这里可以放一些关于产品的常见问题说明。如果需要，这里可以放一些关于产品的常见问题说明。如果需要，这里可以放一些关于产品的常见问题说明。\n              &lt;/p&gt;\n              &lt;h4&gt;转账到银行卡&lt;/h4&gt;\n              &lt;p&gt;\n            如果需要，这里可以放一些关于产品的常见问题说明。如果需要，这里可以放一些关于产品的常见问题说明。如果需要，这里可以放一些关于产品的常见问题说明。\n              &lt;/p&gt;\n            &lt;/div&gt;\n          &lt;/If&gt;\n        &lt;/Form&gt;\n      &lt;/Fragment&gt;\n    );\n  }\n}\n\nexport default Step;\n\n</code></pre><div data-type=\"p\"></div><h5 id=\"p7bdao\" data-type=\"h\"><a class=\"anchor\" id=\"样式改动：\" href=\"#p7bdao\"></a>样式改动：</h5><pre data-syntax=\"less\"><code class=\"language-less\">// style.less\n@import &#x27;~antd/lib/style/themes/default.less&#x27;;\n@import &#x27;~nowrapper/dist/antd/index.css&#x27;; // 新增\n@import &#x27;~noform/dist/index.css&#x27;; // 新增\n</code></pre><div data-type=\"p\"></div><h5 id=\"w8lzfg\" data-type=\"h\"><a class=\"anchor\" id=\"路由改动:\" href=\"#w8lzfg\"></a>路由改动:</h5><div data-type=\"p\"></div><pre data-syntax=\"jsx\"><code class=\"language-jsx\">// pages/.umi/router.js\n{\n    &quot;path&quot;: &quot;/form/step-form&quot;,\n    &quot;name&quot;: &quot;stepform&quot;,\n    &quot;component&quot;: dynamic({ loader: () =&gt; import(&#x27;../Forms/StepForm&#x27;), loading: require(&#x27;/Users/johnchat/Desktop/workspace/my-project/src/components/PageLoading/index&#x27;).default }),\n    &quot;hideChildrenInMenu&quot;: true,\n    &quot;routes&quot;: [\n      ...\n      {\n        &quot;path&quot;: &quot;/form/step-form/info&quot;,\n        &quot;name&quot;: &quot;info&quot;,\n        &quot;component&quot;: dynamic({ loader: () =&gt; import(&#x27;../Forms/StepForm/Step&#x27;), loading: require(&#x27;/Users/johnchat/Desktop/workspace/my-project/src/components/PageLoading/index&#x27;).default }),\n        &quot;exact&quot;: true\n      },\n      {\n        &quot;path&quot;: &quot;/form/step-form/confirm&quot;,\n        &quot;name&quot;: &quot;confirm&quot;,\n        &quot;component&quot;: dynamic({ loader: () =&gt; import(&#x27;../Forms/StepForm/Step&#x27;), loading: require(&#x27;/Users/johnchat/Desktop/workspace/my-project/src/components/PageLoading/index&#x27;).default }),\n        &quot;exact&quot;: true\n      },\n      ...\n    ]\n  },\n</code></pre><div data-type=\"p\"></div>","public":1,"status":null,"likes_count":0,"comments_count":0,"content_updated_at":"2018-12-17T12:27:23.000Z","deleted_at":null,"created_at":"2018-12-17T11:43:58.000Z","updated_at":"2018-12-22T00:10:26.000Z","published_at":"2018-12-17T12:27:23.000Z","first_published_at":null,"word_count":1218,"cover":null,"description":"概述本小节主要是用NoForm去改造 Ant-Desgn-Pro 的 Step-Form。我们会用1个step去代替原本step1和step2这两个文件，开发者应该也能感受到NoForm对于表单的控制力是非常优秀的, 不过这里有点强迫合在一起了，主要目的还是尽可能体现改写后的改进，开发者可以更...","custom_description":null,"_serializer":"v2.doc_detail"}